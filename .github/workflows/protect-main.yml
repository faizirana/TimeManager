name: Protect main branch

on:
    push:
        branches:
            - main
    pull_request:
        types: [opened, reopened, synchronize, edited]
        branches:
            - main

jobs:
    protect-main:
        runs-on: self-hosted

        steps:
            - name: Block direct push to main
              if: github.event_name == 'push'
              run: |
                  echo "âŒ Direct pushes to 'main' are not allowed."
                  echo "Please use a Pull Request from 'dev' instead."
                  exit 1

            - name: Close PRs not from dev
              if: >
                  github.event_name == 'pull_request' &&
                  github.event.pull_request.base.ref == 'main' &&
                  github.event.pull_request.head.ref != 'dev'
              uses: superbrothers/close-pull-request@v3
              with:
                  comment: |
                      ðŸš« Only pull requests **from `dev` to `main`** are allowed.

                      Please rebase your branch on `dev` and open the PR again.
